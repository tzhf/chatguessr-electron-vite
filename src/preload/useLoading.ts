const safeDOM = {
  append(parent: HTMLElement, child: HTMLElement): HTMLElement | void {
    if (!Array.from(parent.children).find((e) => e === child)) {
      return parent.appendChild(child)
    }
  },
  remove(parent: HTMLElement, child: HTMLElement): HTMLElement | void {
    if (Array.from(parent.children).find((e) => e === child)) {
      return parent.removeChild(child)
    }
  }
}

export default function useLoading() {
  const styleContent = `
    .app-loading-wrap {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #1a1a2e;
      z-index: 9;
    }
    .loader {
      width: 60px;
      animation: spin 3s infinite ease-in-out;
    }
    @keyframes spin {
      0% { transform: rotate(0deg) }
      100% { transform: rotate(360deg) }
    }
  `
  const style = document.createElement('style')
  const div = document.createElement('div')

  style.innerHTML = styleContent
  div.className = 'app-loading-wrap'
  div.innerHTML = `<svg class="loader" viewBox="0 0 167599 167599" shape-rendering="geometricPrecision" image-rendering="optimizeQuality" fill-rule="evenodd"><circle cx="83799" cy="83799" r="81308" fill="#fff"/><path d="M83799 0c23140 0 44090 9380 59255 24545s24545 36115 24545 59255-9380 44090-24545 59255c-15164 15165-36115 24545-59255 24545s-44091-9380-59255-24545C9379 127890-1 106940-1 83800s9380-44090 24545-59255S60659 0 83799 0zm55732 28068C125268 13805 105564 4983 83799 4983s-41469 8822-55732 23085S4982 62035 4982 83800s8822 41469 23085 55732 33967 23085 55732 23085 41469-8822 55732-23085 23085-33967 23085-55732-8822-41469-23085-55732z"/><path fill="#59ffd8" d="M154568 43745c6706 11823 10539 25491 10539 40054 0 17344-5434 33417-14688 46617l-6739-7216-293-11392-11134-22122-293-11134-8644-6007-10988 2637-20047-8667-2626-19315 8621-8632 16836 293 6153 8632 16701 2491 16602-6239z"/><path d="M156729 42519c3513 6193 6261 12875 8113 19915 1799 6836 2757 13998 2757 21366 0 8770-1353 17233-3860 25191-2593 8230-6428 15919-11286 22847l-1762 2514-2092-2241-6739-7217-638-682-24-953-279-10824-10886-21629-248-493-15-568-260-9863-6708-4661-9900 2376-799 192-759-328-20047-8667-1291-558-189-1389-2626-19315-165-1216 866-867 8620-8632 748-749 1053 18 16836 293 1259 22 727 1020 5536 7766 15029 2241 15991-6010 1988-747 1048 1847zm3305 21180c-1560-5927-3791-11579-6606-16869l-14585 5481-611 230-625-93-16701-2491-1048-156-617-866-5426-7612-14524-252-7008 7016 2272 16711 17997 7780 10190-2445 1087-261 909 631 8644 6007 1027 714 34 1271 278 10566 10886 21629 248 493 15 568 268 10439 3967 4249c3751-5822 6758-12176 8885-18927 2355-7475 3626-15441 3626-23711 0-6964-898-13700-2581-20101z"/><path fill="#59ffd8" d="M8935 52027l4798 14659 16408 10841 1025-10694-5714-5128-147-8936 19192-2930 14210-8205 8643-14650 8351-2051 2637-8643-17067-2271-7155-5937C33788 16057 17452 31980 8933 52028z"/><path d="M11591 52147l4237 12942 12237 8085 512-5334-4777-4287c-537-480-815-1142-826-1810h-1l-147-8937c-20-1259 901-2313 2113-2494l-1-7 18747-2862 13209-7626 8319-14099c367-621 962-1023 1615-1165l6916-1699 1370-4489-14161-1884c-482-63-913-260-1262-549l-3 4-6017-4992c-9307 3853-17716 9436-24822 16348-7243 7045-13137 15473-17257 24856zm-223 15307L6570 52796h1c-179-551-169-1167 77-1742 4392-10335 10802-19609 18735-27325 7899-7682 17307-13821 27733-17926 834-366 1839-259 2588 361l6614 5488 16343 2174v2a2561 2561 0 0 1 399 86c1311 398 2052 1784 1654 3095l-2595 8505c-211 874-890 1603-1823 1833l-7333 1801-8113 13751-5-3a2458 2458 0 0 1-900 888l-14019 8094a2482 2482 0 0 1-1058 422l-17044 2602 94 5680 4836 4340c609 506 965 1295 885 2143l-1014 10573a2469 2469 0 0 1-411 1260c-758 1145-2301 1458-3446 701L12404 68787c-474-299-851-759-1037-1333z"/><path fill="#59ffd8" d="M142488 27530l-7305 5460-22854-5567-11281 3076-8316-3223 5679-11427h11720l9001-5299c8780 4243 16681 10019 23355 16979z"/><path d="M143977 29525l-7305 5460c-670 500-1509 612-2248 376l-22065-5375-10659 2907c-532 145-1070 106-1547-79l-1 2-8316-3223c-1279-494-1915-1932-1421-3212l90-204-2-1 5679-11427c433-876 1313-1385 2229-1386v-5h11060l8405-4948c741-435 1615-441 2335-94l1-3 12802 7662c4036 2935 7807 6228 11265 9833 951 989 921 2562-68 3514l-237 201 3 3zm-9351 773l4079-3049-8611-7247c-3430-2494-7061-4715-10861-6631l-7653 4505c-408 292-908 464-1448 464H99949l-3779 7604 5017 1945 10390-2834m1337-47l21713 5289"/><path fill="#59ffd8" d="M38932 69908l6007 10548 19484 440 8509 14334 11122-258-3076 14492-10695 10401-293 8937-11280 8204 146 14357-8350-3223-5567-13185-147-28275-13918-3223-5567-11281 147-8789z"/><path d="M41187 68847l5216 9160 18069 408c892 17 1665 503 2089 1219l4-2 7766 13084 9675-225c1371-27 2504 1063 2530 2433a2558 2558 0 0 1-53 564l4 1-3076 14492c-114 541-397 1003-781 1344l-9897 9626-260 7930c-25 799-425 1497-1025 1933l3 4-10246 7451 133 13076c11 1371-1091 2491-2462 2501-322 3-631-57-914-166v1l-8351-3223c-682-263-1182-796-1424-1429l-5535-13110c-135-321-197-655-194-983l-136-26275-12001-2779c-778-178-1386-703-1700-1376l-5541-11228c-201-409-280-846-251-1270l144-8658c10-671 287-1276 727-1716l-7-7 13478-13478c973-973 2551-973 3523 0 210 209 373 447 493 700zm1591 12836l-4389-7708-10470 10470-119 7165 4782 9690 12766 2956-1 4c1101 251 1923 1233 1928 2410l144 27776 4963 11755 3956 1527-107-10520c-67-837 290-1688 1020-2217l10299-7490 251-7643c2-645 253-1289 752-1774l10150-9872 2268-10686-7823 181c-923 79-1853-362-2355-1212l-7805-13149-17996-406c-882 17-1746-437-2212-1258z"/></svg>`

  return {
    appendLoading() {
      safeDOM.append(document.head, style)
      safeDOM.append(document.body, div)
    },
    removeLoading() {
      safeDOM.remove(document.head, style)
      safeDOM.remove(document.body, div)
    }
  }
}
